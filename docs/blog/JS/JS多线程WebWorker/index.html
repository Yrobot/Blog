<!DOCTYPE html><html><head><link rel="icon" href="/favicon.ico"/><link rel="preload" href="//at.alicdn.com/t/font_2533274_yhzuq4j0hfr.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="stylesheet" href="//at.alicdn.com/t/font_2533274_yhzuq4j0hfr.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1DXREC8Y53"></script><script>
              window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments)}
              gtag('js', new Date()); gtag('config', 'G-1DXREC8Y53');
            </script><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta name="keywords" content="yrobot,blog,博客,多线程,Worker,JS,Web"/><meta name="description" content="JS多线程Web Worker"/><title>JS多线程Web Worker</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/886f8c3411ad1c39be9a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/886f8c3411ad1c39be9a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5ac94e1cddf3a5717d52.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5ac94e1cddf3a5717d52.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-ea0a66d28b40ad4ab0d2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-d3984ef788efc6bd8157.js" as="script"/><link rel="preload" href="/_next/static/chunks/597-9d03ea954e499bbdd7af.js" as="script"/><link rel="preload" href="/_next/static/chunks/778-1467ee0b708f5cd375c0.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-9ca82ec4d4aca520c43d.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-49d413833563c7b39a6e.js" as="script"/><link rel="preload" href="/_next/static/chunks/525-eaa095b223f3548a6266.js" as="script"/><link rel="preload" href="/_next/static/chunks/644-2d382948659572c3e3d0.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5B...path%5D-53df0732a14e01452fa5.js" as="script"/></head><body><div id="__next"><div class="mx-auto md:max-w-screen-lg 2xl:max-w-screen-2xl"><div class="md:flex flex-row items-start justify-between"><div class="card menu h-60px md:flex-none md:w-90px md:h-600px md:mr-20px 2xl:w-120px 2xl:h-850px 2xl: 2xl:mr-50px flex flex-row items-center justify-between md:flex-col mb-20px"><a class="iconfont iconlogo flex-none mr-auto ml-15px md:ml-0 md:mr-0 md:mt-20px md:mb-auto w-30px h-30px text-30px md:w-50px md:h-50px md:text-50px 2xl:w-60px 2xl:h-60px 2xl:text-60px"></a><a class="iconfont iconhome cursor-pointer flex-none w-20px h-20px text-20px mr-20px md:mr-0 md:mb-50px md:w-30px md:h-30px md:text-30px" href="/"></a><a class="iconfont icongithub cursor-pointer flex-none w-20px h-20px text-20px mr-20px md:mr-0 md:mb-50px md:w-30px md:h-30px md:text-30px" target="_blank" href="https://github.com/Yrobot"></a><a class="iconfont iconemail cursor-pointer flex-none w-20px h-20px text-20px  mr-20px md:mr-0 md:mb-50px md:w-30px md:h-30px md:text-30px" href="mailto:y_robot@yeah.net?subject="></a><a class="iconfont cursor-pointer flex-none w-20px h-20px text-20px mr-15px md:mr-0 md:mb-20px 2xl:mb-50px md:w-30px md:h-30px md:text-30px iconenglish"></a></div><div class="min-w-0 flex-auto 2xl:flex flex-row items-start justify-between"><div class="min-w-0 2xl:flex-auto 2xl:mr-50px 2xl:pt-30px"><div class="text-center text-xl mb-6px md:text-4xl md:font-bold md:mb-10px 2xl:text-5xl 2xl:mb-15px font-medium">JS多线程Web Worker</div><div class="text-center whitespace-pre-wrap text-gray-500 font-light text-14px leading-20px md:text-16px mb-20px">2018-08-23  |  <!-- -->12<!-- -->分钟<!-- -->  |  yrobot  |  <span class="md:hidden">
</span>多线程,Worker,JS,Web</div><article class="prose prose-sm break-all md:prose 2xl:prose-lg mb-15px md:mb-20px"><p><strong>本页目录：</strong><br><a href="#why">为什么使用 Web Woker</a><br><a href="#what">Web Woker 是什么</a><br><a href="#support">检测浏览器支持</a><br><a href="#new">新建 Web Worker</a><br><a href="#message">mainjs 与 worker 之间的数据传递</a><br><a href="#workerPro">主线程中 worker 的属性</a><br><a href="#selfPro">子线程中的全局属性</a><br><a href="#close">关闭子线程</a></p>
<p><a href="" id="why"></a></p>
<h2 id="为什么使用-web-woker">为什么使用 Web Woker</h2>
<p>核心思想：一些容易阻塞主线程的事情，或者说主线程一个线程完成不了的事情（单页面多连接），可以交给 WebWoker</p>
<h4 id="1-使用专用线程进行数学运算">1. 使用专用线程进行数学运算</h4>
<p>Web Worker 最简单的应用就是用来做后台计算，而这种计算并不会中断前台用户的操作</p>
<h4 id="2-图像处理">2. 图像处理</h4>
<p>通过使用从<code>&lt;canvas&gt;</code>或者<code>&lt;video&gt;</code>元素中获取的数据，可以把图像分割成几个不同的区域并且把它们推送给并行的不同 Workers 来做计算</p>
<h4 id="3-大量数据的检索">3. 大量数据的检索</h4>
<p>当需要在调用 ajax 后处理大量的数据，如果处理这些数据所需的时间长短非常重要，可以在 Web Worker 中来做这些，避免冻结 UI 线程。</p>
<h4 id="4-背景数据分析">4. 背景数据分析</h4>
<p>由于在使用 Web Worker 的时候，我们有更多潜在的 CPU 可用时间，我们现在可以考虑一下 JavaScript 中的新应用场景。例如，我们可以想像在不影响 UI 体验的情况下实时处理用户输入。利用这样一种可能，我们可以想像一个像 Word（Office Web Apps 套装）一样的应用：当用户打字时后台在词典中进行查找，帮助用户自动纠错等等。</p>
<p><a href="" id="what"></a></p>
<h2 id="web-woker-是什么">Web Woker 是什么</h2>
<p>Web Worker 是 HTML5 标准的一部分，这一规范定义了一套 API，它允许一段 JavaScript 程序运行在主线程之外的另外一个线程中。Web Worker 规范中定义了两类工作线程，分别是专用线程 Dedicated Worker 和共享线程 Shared Worker，其中，Dedicated Worker 只能为一个页面所使用，而 Shared Worker 则可以被多个页面所共享。</p>
<p><a href="" id="support"></a></p>
<h2 id="检测浏览器支持">检测浏览器支持</h2>
<pre><code class="language-js"><span class="hljs-regexp">//</span>引入modernizr.js的情况
<span class="hljs-keyword">if</span> (!Modernizr.webworker) {
  alert(<span class="hljs-string">&quot;This browser doesn&#x27;t support Web Worker!&quot;</span>);
}

<span class="hljs-regexp">//</span>未引入modernizr.js的情况
<span class="hljs-keyword">if</span> (typeof Worker !== <span class="hljs-string">&#x27;undefined&#x27;</span>) {
  <span class="hljs-regexp">//</span>支持
} <span class="hljs-keyword">else</span> {
  <span class="hljs-regexp">//</span>不支持code
}
</code></pre>
<p><a href="" id="new"></a></p>
<h2 id="新建-web-worker">新建 Web Worker</h2>
<p><code>var worker = new Worker(&quot;task.js&quot;); //在main.js中new一个woker</code></p>
<p>浏览器原生提供 Worker()构造函数，用来供主线程生成 Worker 线程。<br><code>var myWorker = new Worker(jsUrl, [options]);</code></p>
<p>Worker()构造函数，可以接受两个参数。第一个参数是脚本的网址（必须遵守同源政策），该参数是必需的，且只能加载 JS 脚本，否则会报错。第二个参数是配置对象，该对象可选。它的一个作用就是指定 Worker 的名称，用来区分多个 Worker 线程。</p>
<pre><code class="language-js"><span class="hljs-comment">// 主线程</span>
var myWorker = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Worker(&#x27;<span class="hljs-params">worker</span>.<span class="hljs-params">js</span>&#x27;, { <span class="hljs-params">name</span>: &#x27;<span class="hljs-params">myWorker</span>&#x27; })</span>;

<span class="hljs-comment">// Worker 线程</span>
self.name; <span class="hljs-comment">// myWorker</span>
</code></pre>
<p><a href="" id="message"></a></p>
<h2 id="mainjs-与-worker-之间的数据传递">mainjs 与 worker 之间的数据传递</h2>
<h4 id="主线程sendworker：">主线程—send—&gt;worker：</h4>
<pre><code class="language-js"><span class="hljs-title">worker</span>.postMessage(<span class="hljs-class"><span class="hljs-keyword">data</span>);</span>
//<span class="hljs-class"><span class="hljs-keyword">data</span>可以死各种类型的数据、string、object、array、number。。。</span>
//子线程通过监听函数参数e的<span class="hljs-class"><span class="hljs-keyword">data</span>属性获取上述<span class="hljs-keyword">data</span></span>
</code></pre>
<h4 id="主线程getworker：">主线程&lt;—get—worker：</h4>
<pre><code class="language-js">worker.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Received message &#x27;</span> + event.data);
  <span class="hljs-comment">//相应业务操作</span>
};
</code></pre>
<h4 id="workersend主线程：">worker—send—&gt;主线程：</h4>
<p><code>self.postMessage(data); //self指代worker线程全局对象(同this) </code></p>
<h4 id="workerget主线程：">worker&lt;—get—主线程：</h4>
<pre><code class="language-js"><span class="hljs-built_in">self</span>.addEventListener(
  <span class="hljs-string">&#x27;message&#x27;</span>,
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span></span> {
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;Main data: &#x27;</span> + e.data);
  },
  <span class="hljs-literal">false</span>,
);
</code></pre>
<p><strong>so：</strong><br>当主线程或者子线程要传递 命令以及数据 时：可以传递一个对象<code>{cmd:&#39;go&#39;,data:&#39;dt&#39;}</code>。<br>接收者用<code>event.data.cmd</code>和<code>event.data.data</code>获取命令和数据。</p>
<h4 id="例子：主线程传参-cmd-msg">例子：主线程传参 <code>{cmd:&quot;&quot;, msg:&quot;&quot;}</code></h4>
<pre><code class="language-js"><span class="hljs-built_in">self</span>.addEventListener(
  <span class="hljs-string">&#x27;message&#x27;</span>,
  function (e) {
    <span class="hljs-built_in">var</span> <span class="hljs-built_in">data</span> = e.<span class="hljs-built_in">data</span>;
    switch (<span class="hljs-built_in">data</span>.cmd) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;start&#x27;</span>:
        <span class="hljs-built_in">self</span>.postMessage(<span class="hljs-string">&#x27;WORKER STARTED: &#x27;</span> + <span class="hljs-built_in">data</span>.msg);
        break;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;stop&#x27;</span>:
        <span class="hljs-built_in">self</span>.postMessage(<span class="hljs-string">&#x27;WORKER STOPPED: &#x27;</span> + <span class="hljs-built_in">data</span>.msg);
        <span class="hljs-built_in">self</span>.close(); <span class="hljs-comment">// Terminates the worker.</span>
        break;
      default:
        <span class="hljs-built_in">self</span>.postMessage(<span class="hljs-string">&#x27;Unknown command: &#x27;</span> + <span class="hljs-built_in">data</span>.msg);
    }
  },
  <span class="hljs-literal">false</span>,
);
</code></pre>
<p><a href="" id="workerPro"></a></p>
<h2 id="主线程中-worker-的属性">主线程中 worker 的属性</h2>
<ul>
<li>Worker.onerror：指定 error 事件的监听函数。</li>
<li>Worker.onmessage：指定 message 事件的监听函数，发送过来的数据在 Event.data 属性中。</li>
<li>Worker.onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。</li>
<li>Worker.postMessage()：向 Worker 线程发送消息。</li>
<li>Worker.terminate()：立即终止 Worker 线程。</li>
</ul>
<p><strong>子线程的错误监听实例：</strong></p>
<pre><code class="language-js">worker.onerror(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
  <span class="hljs-built_in">console</span>.log([<span class="hljs-string">&#x27;ERROR: Line &#x27;</span>, e.lineno, <span class="hljs-string">&#x27; in &#x27;</span>, e.filename, <span class="hljs-string">&#x27;: &#x27;</span>, e.message].join(<span class="hljs-string">&#x27;&#x27;</span>));
});

<span class="hljs-comment">// 或者</span>
worker.addEventListener(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<p><a href="" id="selfPro"></a></p>
<h2 id="子线程中的全局属性">子线程中的全局属性</h2>
<p>Web Worker 有自己的全局对象，不是主线程的 window，而是一个专门为 Worker 定制的全局对象.</p>
<ul>
<li>self.name：Worker 的名字。该属性只读，由构造函数指定。</li>
<li>self.onmessage：指定 message 事件的监听函数。</li>
<li>self.onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。</li>
<li>self.close()：关闭 Worker 线程。</li>
<li>self.postMessage()：向产生这个 Worker 线程发送消息。</li>
<li><strong>self.importScripts()：加载 JS 脚本。</strong></li>
</ul>
<p><a href="" id="close"></a></p>
<h2 id="关闭子线程">关闭子线程</h2>
<pre><code class="language-js"><span class="hljs-comment">// 主线程</span>
worker.<span class="hljs-built_in">terminate</span>();

<span class="hljs-comment">// Worker 线程</span>
self.<span class="hljs-built_in">close</span>();
</code></pre>
</article><div class="overflow-hidden flex flex-row items-center justify-between pt-10px md:pt-15px border-t-1px border-gray-200 mb-20px md:mb-40px"><span class="iconfont iconleft flex-none w-14px h-14px text-14px md:w-16px md:h-16px md:text-16px md:mr-4px"></span><a href="/blog/MarkDown/markdown注意点" class="flex-none w-40% text-14px leading-16px md:text-16px overflow-hidden whitespace-nowrap overflow-ellipsis">markdown注意点</a><div class="mx-auto"></div><a href="/blog/JSON/JSON使用注意点" class="flex-none w-40% text-right text-14px leading-16px md:text-16px overflow-hidden whitespace-nowrap overflow-ellipsis">JSON使用注意点</a><span class="iconfont iconright flex-none w-14px h-14px text-14px md:w-16px md:h-16px md:text-16px md:ml-4px"></span></div><div class="mb-20px"><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div id="vcomments"></div></div></div><div class="2xl:flex-none 2xl:w-580px"><div class="pt-24px md:pt-24px 2xl:pt-30px mb-15px md:mb-20px"><div class="relative card pl-20px flex flex-col items-start justify-center h-96px md:h-126px 2xl:h-160px pr-120px md:pr-170px 2xl:pr-195px"><div class="text-20px md:text-26px 2xl:text-36px font-bold mb-10px md:mb-15px 2xl:mb-15px">你好！我是Yrobot</div><div class="text-14px md:text-16px 2xl:text-16px">欢迎来到我的博客，希望你在这里玩得开心！</div><img class="h-120px md:h-150px 2xl:h-190px absolute bottom-0 right-20px" src="/assets/person.svg" alt="person"/></div></div><div class="card mb-15px md:mb-20px overflow-hidden"><a href="https://github.com/Yrobot" target="_blank"><img src="https://github-readme-stats.vercel.app/api?count_private=true&amp;show_icons=true&amp;username=yrobot&amp;title_color=000000&amp;icon_color=000000&amp;text_color=000000&amp;border_color=F4F4F5&amp;bg_color=F4F4F5" alt="GithubCard"/></a></div><div class="card mb-15px md:mb-20px overflow-hidden"><a href="https://github.com/Yrobot/mina-touch" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin?repo=mina-touch&amp;username=yrobot&amp;title_color=000000&amp;icon_color=000000&amp;text_color=000000&amp;border_color=F4F4F5&amp;bg_color=F4F4F5" alt="GithubCard"/></a></div><div class="card mb-15px md:mb-20px overflow-hidden"><a href="https://github.com/Yrobot/react-mobile-table" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin?repo=react-mobile-table&amp;username=yrobot&amp;title_color=000000&amp;icon_color=000000&amp;text_color=000000&amp;border_color=F4F4F5&amp;bg_color=F4F4F5" alt="GithubCard"/></a></div><div class="card mb-15px md:mb-20px overflow-hidden"><a href="https://github.com/Yrobot/mina-popups" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin?repo=mina-popups&amp;username=yrobot&amp;title_color=000000&amp;icon_color=000000&amp;text_color=000000&amp;border_color=F4F4F5&amp;bg_color=F4F4F5" alt="GithubCard"/></a></div></div></div></div><footer class="bg-accent-1"></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"pre":{"path":"_blogs/MarkDown/markdown注意点.md","url":"/blog/MarkDown/markdown注意点","title":"markdown注意点","author":"yrobot","keywords":"markdown,注意","createTime":1535040000000,"length":377,"content":"\u003cp\u003e\u003cstrong\u003e本页目录：\u003c/strong\u003e\u003cbr\u003e\u003ca href=\"#url\"\u003e链接\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#snippet\"\u003eVS-Code:snippet\u003c/a\u003e  \u003c/p\u003e\n\u003cp\u003e\u003ca id='url'\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"链接\"\u003e链接\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e链接跳转：\u003c/strong\u003e \u003ccode\u003e[描述](url)\u003c/code\u003e\u003cbr\u003e\u003cstrong\u003e图片：\u003c/strong\u003e\u003ccode\u003e![](url)\u003c/code\u003e  \u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003emarkdown语法要求：\u003c/strong\u003e  \u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e页内锚点链接：字母要统统小写，空格统统要替换成 \u0026#39;-\u0026#39;。  \u003c/li\u003e\n\u003cli\u003e外部链接：不可包含空格。  \u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e__解决方案__：直接使用a标签即可  \u003c/p\u003e\n\u003cp\u003e\u003ca id='snippet'\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"vs-codesnippet\"\u003eVS-Code:snippet\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e可以在vscode用户代码块添加对markdown的snippet。\u003c/li\u003e\n\u003cli\u003e个人vscode的.md文件一直不提示，无奈修改\u0026quot;editor.action.triggerSuggest\u0026quot;快捷键，强制唤醒md文件的代码提示。\u003c/li\u003e\n\u003c/ul\u003e\n"},"blog":{"path":"_blogs/JS/JS多线程WebWorker/README.md","url":"/blog/JS/JS多线程WebWorker","title":"JS多线程Web Worker","author":"yrobot","keywords":"多线程,Worker,JS,Web","createTime":1534953600000,"length":3842,"content":"\u003cp\u003e\u003cstrong\u003e本页目录：\u003c/strong\u003e\u003cbr\u003e\u003ca href=\"#why\"\u003e为什么使用 Web Woker\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#what\"\u003eWeb Woker 是什么\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#support\"\u003e检测浏览器支持\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#new\"\u003e新建 Web Worker\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#message\"\u003emainjs 与 worker 之间的数据传递\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#workerPro\"\u003e主线程中 worker 的属性\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#selfPro\"\u003e子线程中的全局属性\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#close\"\u003e关闭子线程\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"why\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"为什么使用-web-woker\"\u003e为什么使用 Web Woker\u003c/h2\u003e\n\u003cp\u003e核心思想：一些容易阻塞主线程的事情，或者说主线程一个线程完成不了的事情（单页面多连接），可以交给 WebWoker\u003c/p\u003e\n\u003ch4 id=\"1-使用专用线程进行数学运算\"\u003e1. 使用专用线程进行数学运算\u003c/h4\u003e\n\u003cp\u003eWeb Worker 最简单的应用就是用来做后台计算，而这种计算并不会中断前台用户的操作\u003c/p\u003e\n\u003ch4 id=\"2-图像处理\"\u003e2. 图像处理\u003c/h4\u003e\n\u003cp\u003e通过使用从\u003ccode\u003e\u0026lt;canvas\u0026gt;\u003c/code\u003e或者\u003ccode\u003e\u0026lt;video\u0026gt;\u003c/code\u003e元素中获取的数据，可以把图像分割成几个不同的区域并且把它们推送给并行的不同 Workers 来做计算\u003c/p\u003e\n\u003ch4 id=\"3-大量数据的检索\"\u003e3. 大量数据的检索\u003c/h4\u003e\n\u003cp\u003e当需要在调用 ajax 后处理大量的数据，如果处理这些数据所需的时间长短非常重要，可以在 Web Worker 中来做这些，避免冻结 UI 线程。\u003c/p\u003e\n\u003ch4 id=\"4-背景数据分析\"\u003e4. 背景数据分析\u003c/h4\u003e\n\u003cp\u003e由于在使用 Web Worker 的时候，我们有更多潜在的 CPU 可用时间，我们现在可以考虑一下 JavaScript 中的新应用场景。例如，我们可以想像在不影响 UI 体验的情况下实时处理用户输入。利用这样一种可能，我们可以想像一个像 Word（Office Web Apps 套装）一样的应用：当用户打字时后台在词典中进行查找，帮助用户自动纠错等等。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"what\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"web-woker-是什么\"\u003eWeb Woker 是什么\u003c/h2\u003e\n\u003cp\u003eWeb Worker 是 HTML5 标准的一部分，这一规范定义了一套 API，它允许一段 JavaScript 程序运行在主线程之外的另外一个线程中。Web Worker 规范中定义了两类工作线程，分别是专用线程 Dedicated Worker 和共享线程 Shared Worker，其中，Dedicated Worker 只能为一个页面所使用，而 Shared Worker 则可以被多个页面所共享。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"support\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"检测浏览器支持\"\u003e检测浏览器支持\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e引入modernizr.js的情况\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!Modernizr.webworker) {\n  alert(\u003cspan class=\"hljs-string\"\u003e\u0026quot;This browser doesn\u0026#x27;t support Web Worker!\u0026quot;\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e未引入modernizr.js的情况\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (typeof Worker !== \u003cspan class=\"hljs-string\"\u003e\u0026#x27;undefined\u0026#x27;\u003c/span\u003e) {\n  \u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e支持\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n  \u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e不支持code\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"new\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"新建-web-worker\"\u003e新建 Web Worker\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003evar worker = new Worker(\u0026quot;task.js\u0026quot;); //在main.js中new一个woker\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e浏览器原生提供 Worker()构造函数，用来供主线程生成 Worker 线程。\u003cbr\u003e\u003ccode\u003evar myWorker = new Worker(jsUrl, [options]);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eWorker()构造函数，可以接受两个参数。第一个参数是脚本的网址（必须遵守同源政策），该参数是必需的，且只能加载 JS 脚本，否则会报错。第二个参数是配置对象，该对象可选。它的一个作用就是指定 Worker 的名称，用来区分多个 Worker 线程。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 主线程\u003c/span\u003e\nvar myWorker = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-constructor\"\u003eWorker(\u0026#x27;\u003cspan class=\"hljs-params\"\u003eworker\u003c/span\u003e.\u003cspan class=\"hljs-params\"\u003ejs\u003c/span\u003e\u0026#x27;, { \u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e: \u0026#x27;\u003cspan class=\"hljs-params\"\u003emyWorker\u003c/span\u003e\u0026#x27; })\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// Worker 线程\u003c/span\u003e\nself.name; \u003cspan class=\"hljs-comment\"\u003e// myWorker\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"message\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"mainjs-与-worker-之间的数据传递\"\u003emainjs 与 worker 之间的数据传递\u003c/h2\u003e\n\u003ch4 id=\"主线程sendworker：\"\u003e主线程—send—\u0026gt;worker：\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-title\"\u003eworker\u003c/span\u003e.postMessage(\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e);\u003c/span\u003e\n//\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e可以死各种类型的数据、string、object、array、number。。。\u003c/span\u003e\n//子线程通过监听函数参数e的\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e属性获取上述\u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"主线程getworker：\"\u003e主线程\u0026lt;—get—worker：\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003eworker.onmessage = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Received message \u0026#x27;\u003c/span\u003e + event.data);\n  \u003cspan class=\"hljs-comment\"\u003e//相应业务操作\u003c/span\u003e\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"workersend主线程：\"\u003eworker—send—\u0026gt;主线程：\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eself.postMessage(data); //self指代worker线程全局对象(同this) \u003c/code\u003e\u003c/p\u003e\n\u003ch4 id=\"workerget主线程：\"\u003eworker\u0026lt;—get—主线程：\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-built_in\"\u003eself\u003c/span\u003e.addEventListener(\n  \u003cspan class=\"hljs-string\"\u003e\u0026#x27;message\u0026#x27;\u003c/span\u003e,\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(e)\u003c/span\u003e\u003c/span\u003e {\n    console.\u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Main data: \u0026#x27;\u003c/span\u003e + e.data);\n  },\n  \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eso：\u003c/strong\u003e\u003cbr\u003e当主线程或者子线程要传递 命令以及数据 时：可以传递一个对象\u003ccode\u003e{cmd:\u0026#39;go\u0026#39;,data:\u0026#39;dt\u0026#39;}\u003c/code\u003e。\u003cbr\u003e接收者用\u003ccode\u003eevent.data.cmd\u003c/code\u003e和\u003ccode\u003eevent.data.data\u003c/code\u003e获取命令和数据。\u003c/p\u003e\n\u003ch4 id=\"例子：主线程传参-cmd-msg\"\u003e例子：主线程传参 \u003ccode\u003e{cmd:\u0026quot;\u0026quot;, msg:\u0026quot;\u0026quot;}\u003c/code\u003e\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-built_in\"\u003eself\u003c/span\u003e.addEventListener(\n  \u003cspan class=\"hljs-string\"\u003e\u0026#x27;message\u0026#x27;\u003c/span\u003e,\n  function (e) {\n    \u003cspan class=\"hljs-built_in\"\u003evar\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edata\u003c/span\u003e = e.\u003cspan class=\"hljs-built_in\"\u003edata\u003c/span\u003e;\n    switch (\u003cspan class=\"hljs-built_in\"\u003edata\u003c/span\u003e.cmd) {\n      \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;start\u0026#x27;\u003c/span\u003e:\n        \u003cspan class=\"hljs-built_in\"\u003eself\u003c/span\u003e.postMessage(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;WORKER STARTED: \u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003edata\u003c/span\u003e.msg);\n        break;\n      \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;stop\u0026#x27;\u003c/span\u003e:\n        \u003cspan class=\"hljs-built_in\"\u003eself\u003c/span\u003e.postMessage(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;WORKER STOPPED: \u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003edata\u003c/span\u003e.msg);\n        \u003cspan class=\"hljs-built_in\"\u003eself\u003c/span\u003e.close(); \u003cspan class=\"hljs-comment\"\u003e// Terminates the worker.\u003c/span\u003e\n        break;\n      default:\n        \u003cspan class=\"hljs-built_in\"\u003eself\u003c/span\u003e.postMessage(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Unknown command: \u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003edata\u003c/span\u003e.msg);\n    }\n  },\n  \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"workerPro\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"主线程中-worker-的属性\"\u003e主线程中 worker 的属性\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eWorker.onerror：指定 error 事件的监听函数。\u003c/li\u003e\n\u003cli\u003eWorker.onmessage：指定 message 事件的监听函数，发送过来的数据在 Event.data 属性中。\u003c/li\u003e\n\u003cli\u003eWorker.onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。\u003c/li\u003e\n\u003cli\u003eWorker.postMessage()：向 Worker 线程发送消息。\u003c/li\u003e\n\u003cli\u003eWorker.terminate()：立即终止 Worker 线程。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e子线程的错误监听实例：\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003eworker.onerror(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log([\u003cspan class=\"hljs-string\"\u003e\u0026#x27;ERROR: Line \u0026#x27;\u003c/span\u003e, e.lineno, \u003cspan class=\"hljs-string\"\u003e\u0026#x27; in \u0026#x27;\u003c/span\u003e, e.filename, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;: \u0026#x27;\u003c/span\u003e, e.message].join(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e));\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// 或者\u003c/span\u003e\nworker.addEventListener(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;error\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"selfPro\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"子线程中的全局属性\"\u003e子线程中的全局属性\u003c/h2\u003e\n\u003cp\u003eWeb Worker 有自己的全局对象，不是主线程的 window，而是一个专门为 Worker 定制的全局对象.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eself.name：Worker 的名字。该属性只读，由构造函数指定。\u003c/li\u003e\n\u003cli\u003eself.onmessage：指定 message 事件的监听函数。\u003c/li\u003e\n\u003cli\u003eself.onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。\u003c/li\u003e\n\u003cli\u003eself.close()：关闭 Worker 线程。\u003c/li\u003e\n\u003cli\u003eself.postMessage()：向产生这个 Worker 线程发送消息。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eself.importScripts()：加载 JS 脚本。\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"close\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"关闭子线程\"\u003e关闭子线程\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 主线程\u003c/span\u003e\nworker.\u003cspan class=\"hljs-built_in\"\u003eterminate\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment\"\u003e// Worker 线程\u003c/span\u003e\nself.\u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n"},"next":{"path":"_blogs/JSON/JSON使用注意点.md","url":"/blog/JSON/JSON使用注意点","title":"JSON使用注意点","slug":"home","author":"yrobot","keywords":"JSON,注意,使用","createTime":1534953600000,"length":1675,"content":"\u003cp\u003e\u003cstrong\u003e本页目录：\u003c/strong\u003e\u003cbr\u003e\u003ca href=\"#import\"\u003e关于引入\u003c/a\u003e\u003cbr\u003e\u003ca href=\"#todo\"\u003e关于操作\u003c/a\u003e  \u003c/p\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"import\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"关于引入？\"\u003e关于引入？\u003c/h2\u003e\n\u003cp\u003e早期的JSON解析器基本上就是使用JavaScript的eval()函数。由于JSON是JavaScript语法的自己，因此eval()函数可以解析、解释并返回JavaScript的对象和数组。\u003c/p\u003e\n\u003cp\u003eECMAScript 5对解析JSON的行为进行了规范，定义了全局对象JSON。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://ws2.sinaimg.cn/large/006tNbRwgy1fuklqfg3zcj30hi06sjro.jpg\" alt=\"\"\u003e\n据网上资料，浏览器对JSON的支持情况 ： IE8 chrome1+ safari3+ firefox3+，所以在这些浏览器中使用JSON可以不引入json2.js，在其他低版本浏览器中需要引入json2.js。所以，默认引入即可，去除注释的json2也才8kb不到。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"\" id=\"todo\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"关于操作？\"\u003e关于操作？\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e \u003cstrong\u003eJSON.parse(string) ：接受一个 JSON字符串 并将其转换成一个 JavaScript 对象。\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e \u003cstrong\u003eJSON.stringify(obj) ：接受一个 JavaScript 对象并将其转换为一个 JSON字符串。\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"1-jsonparse-不允许在末尾添加多余的逗号\"\u003e1. \u003cstrong\u003eJSON.parse() 不允许在末尾添加多余的逗号\u003c/strong\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e下面两行代码都会抛出错误:\u003cbr\u003e1 JSON.parse(\u0026#39;[1, 2, 3, 4, ]\u0026#39;);\u003cbr\u003e2 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 1, }\u0026#39;);\u003cbr\u003e3 // SyntaxError JSON.parse: unexpected character\u003cbr\u003e4 // at line 1 column 14 of the JSON data  \u003c/li\u003e\n\u003cli\u003e省略末尾多余的逗号解析 JSON 就是正确:\u003cbr\u003e1 JSON.parse(\u0026#39;[1, 2, 3, 4 ]\u0026#39;);\u003cbr\u003e2 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 1 }\u0026#39;);  \u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"2-json-的属性名必须使用双引号\"\u003e2. \u003cstrong\u003eJSON 的属性名必须使用双引号\u003c/strong\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e属性名上不能使用单引号，例如： \u0026#39;foo\u0026#39;。\u003cbr\u003e1 JSON.parse(\u0026quot;{\u0026#39;foo\u0026#39; : 1 }\u0026quot;);\u003cbr\u003e2 // SyntaxError: JSON.parse: expected property name or \u0026#39;}\u0026#39;\u003cbr\u003e3 // at line 1 column 2 of the JSON data  \u003c/li\u003e\n\u003cli\u003e取而代之，写成 \u0026quot;foo\u0026quot;：\u003cbr\u003e1 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 1 }\u0026#39;);  \u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"3-数字不能用-0-开头，比如01，并且你的小数点后面必须跟着至少一个数字。\"\u003e3. \u003cstrong\u003e数字不能用 0 开头，比如01，并且你的小数点后面必须跟着至少一个数字。\u003c/strong\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e数字不能用 0 开头，比如01 ,小数点后面必须跟着至少一个数字。\n1 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 01 }\u0026#39;);\u003cbr\u003e2 // SyntaxError: JSON.parse: expected \u0026#39;,\u0026#39; or \u0026#39;}\u0026#39; after property value\u003cbr\u003e3 // in object at line 1 column 2 of the JSON data\u003cbr\u003e|\n4 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 1. }\u0026#39;);\u003cbr\u003e5 // SyntaxError: JSON.parse: unterminated fractional number\u003cbr\u003e6 // at line 1 column 2 of the JSON data  \u003c/li\u003e\n\u003cli\u003e正确的写法应该是只写一个1，不书写前面的0。在小数点的后面至少要跟上一个数字:\u003cbr\u003e1 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 1 }\u0026#39;);\u003cbr\u003e2 JSON.parse(\u0026#39;{\u0026quot;foo\u0026quot; : 1.0 }\u0026#39;);  \u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/blog/[...path]","query":{"path":["JS","JS多线程WebWorker"]},"buildId":"ui63dtMcwXegm0WGQd_Kq","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="/_next/static/chunks/webpack-ea0a66d28b40ad4ab0d2.js" async=""></script><script src="/_next/static/chunks/framework-d3984ef788efc6bd8157.js" async=""></script><script src="/_next/static/chunks/597-9d03ea954e499bbdd7af.js" async=""></script><script src="/_next/static/chunks/778-1467ee0b708f5cd375c0.js" async=""></script><script src="/_next/static/chunks/main-9ca82ec4d4aca520c43d.js" async=""></script><script src="/_next/static/chunks/pages/_app-49d413833563c7b39a6e.js" async=""></script><script src="/_next/static/chunks/525-eaa095b223f3548a6266.js" async=""></script><script src="/_next/static/chunks/644-2d382948659572c3e3d0.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5B...path%5D-53df0732a14e01452fa5.js" async=""></script><script src="/_next/static/ui63dtMcwXegm0WGQd_Kq/_buildManifest.js" async=""></script><script src="/_next/static/ui63dtMcwXegm0WGQd_Kq/_ssgManifest.js" async=""></script></body></html>